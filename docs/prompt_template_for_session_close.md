# 【コピー＆ペースト用・決定版】Gemini CLI 作業終了・記録プロンプト

```markdown
# 作業終了プロセス開始: 詳細記録と安全なアップロード

お疲れ様です。本日の作業を終了し、シャットダウンに備えます。
これまでの対話で確立した、再現性と安全性を最優先する手順に基づき、以下のタスクを**一字一句、厳密に**実行してください。

### 1. セッション作業記録の作成 (詳細版)

これは単なる要約ではありません。本日の思考と作業の全プロセスを、第三者が追体験できるレベルで記録する「航海日誌」です。以下の構成と要件を**完全に満たす**詳細なドキュメントを作成してください。

-   **ファイル名**: `docs/session_summaries/YYYYMMDD-HHMM.md` (現在の日時を使用)
    - **ファイル形式:** 単一のmdファイル
    - **ファイル名:** `YYYYMMDD-HHMM.md` の形式で出力すること。
    - `YYYYMMDD` は現在の日付とする。
    - `HHMM` は現在の**日本標準時(JST)**の時刻（時・分）とする。
    - **時刻の取得手順：必ずGoogle検索等のWeb調査機能を用いて「現在の日本時間」を正確に確認し**、その時刻を使用すること。

-   **記載必須項目**:
    1.  **目的と課題**:
        -   このセッションで解決しようとした、ビジネス上または技術上の「課題」は何か。
        -   作業開始前の「仮説」はどのようなものだったか。（例：「エラーの原因はおそらくUI側にあるだろう」）
    2.  **実行プロセスと発見の時系列記録**:
        -   課題解決のために、どのような手順で調査と修正を試みたか、その思考プロセスを時系列で記述する。
        -   **発生した具体的なエラーとそのメッセージを、省略せずにそのまま引用する。**（例：「`BadRequest: IN UNNEST must be an array`」）
        -   各エラーに対して、どのように原因を分析し、何を試したかを記述する。
        -   最終的に特定された「根本原因」は何か。
        -   問題を解決した「最終的なコードの変更点」は何か。（可能であれば `diff` 形式で示す）
    3.  **確立された新しいベストプラクティス**:
        -   このセッションを通じて学んだこと、あるいはプロジェクトに導入された新しい設計思想や開発ルールは何か。（例：「UIとロジックの分離の徹底」「テストファーストのアプローチ」）
    4.  **現状のステータス**:
        -   本日の作業範囲における、明確な完了状況。（例：「SQL検索ロジックの安定化は完了。Streamlit上での動作も確認済み。」）
    5.  **次回作業への引き継ぎ事項**:
        -   未解決の課題や、将来の修正が必要になる可能性のある「技術的負債」はあるか。
        -   次にプロジェクトを開いた開発者が、最初に何をすべきかの具体的なステップ。

### 2. システム設計ガイドの更新 (v-next)

これは「作業履歴」ではなく、**現在のシステムの正しい姿を反映した、未来の開発者のための「設計仕様書」**です。以下の要件に基づき、既存の最新バージョンから数字を1つ進めたファイル名で、新しい設計ガイドを作成してください。

-   **ファイル名**: `docs/DesignGuide3.2_v[N+1].md` (例: `DesignGuide3.2_v4.md`)
-   **記載必須項目**:
    1.  **設計原則**: プロジェクト全体を貫く設計思想（関心の分離、テスト可能性など）を明記する。
    2.  **アーキテクチャ**: Mermaid図を用いて、主要コンポーネント間の最新のデータフローを視覚的に示す。
    3.  **コンポーネント実装ガイド (最重要)**:
        -   主要なファイル・ディレクトリごとに、その「責務（Role）」と「設計の意図（Design Philosophy）」を詳細に解説する。
        -   **`state.py`**: なぜこのクラスが必要なのか。Single Source of Truthとしての役割。
        -   **`agent.py`**: なぜ「エージェント」と呼ぶのか。オーケストレーターとしての役割。
        -   **`bq_client.py`**: なぜ認証情報を引数で渡せる設計になっているのか。依存性注入の重要性。
        -   **`strategies/`**: なぜストラテジーパターンを採用したのか。将来の拡張性。
        -   **`tests/`**: このテストスクリプトがプロジェクトの品質保証においてどのような役割を果たすのか。どうやって使うのか。
    4.  **開発ロードマップ**:
        -   完了したタスクを明確に「完了済み」セクションに移動する。
        -   今後の開発タスクについて、その「目的」と具体的な「実装案」を、他の開発者が読んでも作業に着手できるレベルで記述する。

### 3. GitHubへのアップロード (エラー完全回避フロー)
Githubにアップロードしてください。https://github.com/Atsuki0620/PatentFinder3.2/tree/main
これまでの対話で発生したエラーを撲滅するため、以下の手順を**機械的に**実行してください。

1.  **`git status`**: 変更内容の最終確認。
2.  **`git add .`**: 全ての変更をステージング。
3.  **コミットメッセージのファイル保存**:
    -   本日の作業内容全体（サマリー作成、設計ガイド更新を含む）を要約した、分かりやすいコミットメッセージを生成する。
    -   生成したメッセージを、プロジェクトルートに `commit_message.txt` という名前で書き出す。
4.  **ファイル指定でのコミット**:
    -   `git commit -F commit_message.txt` を実行する。
5.  **リモートとの同期 (Pull-before-Push)**:
    -   まず `git branch` を実行して、現在のブランチ名（例: `master`）を正確に確認する。
    -   確認したブランチ名を使い、`git pull origin [確認したブランチ名]` を実行して、pushリジェクトを確実に防止する。
6.  **プッシュ実行**:
    -   `git push origin [確認したブランチ名]` を実行する。
7.  **クリーンアップ**:
    -   `del commit_message.txt` を実行し、一時ファイルを削除する。

以上の全プロセスが完了したら、報告してください。
```
