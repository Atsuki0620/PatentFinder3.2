# GEMINI.md - PatentFinder 3.2 開発憲章 (2025/07/25版)

## 1. プロジェクト理念

**「拡張性を担保し、UIとロジックを分離した、保守性の高い特許調査アプリケーションを構築する」**

-   将来の検索能力向上（新しい検索戦略の追加）を容易にすることが最優先事項である。
-   UIの変更がコアロジックに影響を与えず、その逆も然り、という疎結合な設計を維持する。

## 2. アーキテクチャ方針

### 2.1. 責務分離 (Separation of Concerns)
-   **`src/app.py` (エントリーポイント層)**: アプリケーションの起動とUIモジュールの呼び出しに専念する。
-   **`src/ui/` (プレゼンテーション層)**: ユーザーへの情報表示と入力受付のみを担当する。ビジネスロジックを含まない。
-   **`src/core/` (ビジネスロジック層)**: アプリケーションの核となる機能（LLM連携、SQL生成、DBアクセス）を担当する。UIに依存しない。
-   **`src/utils/` (ユーティリティ層)**: プロジェクト横断的な便利機能を提供する。

### 2.2. 拡張性の核：戦略パターン
-   検索ロジックは**ストラテジーパターン**を用いて実装する。
-   すべての検索戦略は `src/core/strategies/base.py` の抽象基底クラスを継承し、統一されたインターフェースを持つ。
-   これにより、`agent.py` は具体的な戦略の実装を知ることなく、動的に戦略を切り替え・実行できる。

## 3. 開発規約 (不変)

1.  **SQLインジェクション対策**: `bq_client.py` で実行するSQLは、必ずパラメータ化クエリを使用すること。文字列結合によるクエリ生成を禁止する。
2.  **機密情報管理**: APIキーやサービスアカウント情報は、`st.session_state` を経由してロードすること。コード、リポジトリ、ドキュメントへのハードコーディングを固く禁ずる。
3.  **状態管理**: Streamlitのセッション状態は、`src/core/state.py` で定義されたデータクラスを介してのみ操作する。`st.session_state` に直接マジックストリングでアクセスしない。
4.  **依存関係の方向**: 依存関係は必ず `app.py` -> `ui` -> `core` -> `utils` の一方向とする。下位層（例: `core`）が上位層（例: `ui`）をインポートしてはならない。

## 4. GitHubへのアップロード手順（機密情報対応）

GitHubのPush Protection機能により、機密情報（APIキー、JSONキーファイル）を含むファイルはプッシュがブロックされる。以下の手順で対応する。

1.  **`.gitignore`の作成**:
    プロジェクトルートに`.gitignore`ファイルを作成し、機密情報ファイル（`.env`, `*.json`など）や不要なキャッシュファイル（`__pycache__/`など）を記述する。

2.  **Gitインデックスのクリアと再追加**:
    既に`git add`してしまったファイルを`.gitignore`の対象にするため、一度Gitのキャッシュをクリアしてから再度ファイルを追加する。
    ```bash
    git rm -r --cached .
    git add .
    ```

3.  **コミットとプッシュ**:
    クリーンな状態でコミットし、リモートリポジトリにプッシュする。
    ```bash
    git commit -m "feat: Implement core features and exclude secrets"
    git push -u origin master
    ```
    ※初回プッシュや履歴の修正後は`--force`が必要な場合があるが、多人数開発では使用に細心の注意を払うこと。

## 5. 参考ドキュメント
-   **具体的な実装計画**: [DesignGuide3.2.md](./DesignGuide3.2.md)
-   **利用者向け手順**: [../README.md](../README.md)
-   **これまでの開発経緯**: [history.md](./history.md)